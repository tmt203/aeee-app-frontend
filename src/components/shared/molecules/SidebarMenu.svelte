<script lang="ts">
	import { Accordion, AccordionItem } from "@skeletonlabs/skeleton";
	import { sidebarExpanded } from "@store/sidebar";
	import type { SideBarGroupProps } from "@type/components/sidebar.type";
	import clsx from "clsx";
	import { t } from "svelte-i18n";
	import { SidebarItem } from "../atoms";

	export let currentGroup: string;
	export let subGroupId: string = "";
	export let sideBar: SideBarGroupProps[];
	export let expanded: boolean;

	let open: boolean = !!sideBar
		.flatMap((item) => item.items)
		.find((item) => item.group === currentGroup)?.children?.length;
</script>

<div
	class={clsx(
		"mt-3 flex w-full flex-col overflow-y-auto bg-white max-[375px]:max-h-[440px] dark:bg-gray-800"
	)}
>
	{#each sideBar as { group, items }}
		{#if group.length}
			{#if expanded || $sidebarExpanded}
				<span class="my-1 text-xs font-semibold uppercase text-gray-400 dark:text-gray-500">
					{$t(group)}
				</span>
			{:else}
				<hr class="mx-auto my-3 h-[1px] w-12 !border-none bg-gray-300 dark:bg-gray-600" />

				<!-- <hr class="mb-1 h-[1px] w-full !border-none bg-surface-400/30" /> -->
			{/if}
		{/if}

		{#each items as sideBarItem}
			{#if !expanded && !$sidebarExpanded}
				<div
					class={clsx(
						"my-1 flex h-9 w-12 cursor-pointer items-center justify-center self-center rounded-lg px-1 py-2",
						{
							"bg-[linear-gradient(135deg,var(--tw-gradient-stops))] from-primary-500/[0.12] to-primary-500/[0.04] dark:from-primary-500/[0.24]":
								sideBarItem.group === currentGroup,
							"bg-white transition-colors hover:bg-primary-500/10 dark:bg-tertiary-600":
								sideBarItem.group !== currentGroup
						}
					)}
				>
					<svelte:component
						this={sideBarItem.icon}
						size={16}
						strokeWidth={2.5}
						class={clsx({
							"stroke-secondary-text-color": sideBarItem.group !== currentGroup,
							"stroke-primary-500": sideBarItem.group === currentGroup
						})}
					/>
				</div>
			{:else if sideBarItem.children && sideBarItem.children.length}
				<!-- Sidebar Sub Children Menu -->
				<Accordion
					width="my-1"
					padding="px-2"
					transitionInParams={{ duration: 300 }}
					transitionOutParams={{ duration: 300 }}
					regionPanel="space-y-2 py-1 !p-0 [&_.sidebarItem]:pl-4"
					regionControl="text-sm font-medium !py-2 !space-x-2 transition-colors hover:!bg-primary-500/10"
				>
					<AccordionItem bind:open rounded="rounded-lg">
						<svelte:fragment slot="lead">
							<svelte:component
								this={sideBarItem.icon}
								color="#aaaeb4"
								size={16}
								strokeWidth={2.5}
								class="stroke-secondary-text-color"
							/>
						</svelte:fragment>
						<svelte:fragment slot="summary">
							{#if expanded || $sidebarExpanded}
								{$t(sideBarItem.label)}
							{/if}
						</svelte:fragment>
						<svelte:fragment slot="content">
							{#each sideBarItem.children as child}
								<SidebarItem
									sideBarItem={child}
									active={child.subGroup === subGroupId}
									bind:subGroupId
									bind:currentGroup
								/>
							{/each}
						</svelte:fragment>
					</AccordionItem>
				</Accordion>
			{:else}
				<!-- Sidebar Sub Menu Item -->
				<SidebarItem
					{sideBarItem}
					active={!sideBarItem.children && sideBarItem.group === currentGroup}
					bind:subGroupId
					bind:currentGroup
				/>
			{/if}
		{/each}
	{/each}
</div>
